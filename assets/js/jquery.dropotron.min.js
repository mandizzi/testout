/* jquery.dropotron.js v1.4.3 | (c) @ajlkn | github.com/ajlkn/jquery.dropotron | MIT licensed */
!function($) {
    $.fn.disableSelection_dropotron = function() {
        return $(this).css({
            "user-select": "none",
            "-khtml-user-select": "none",
            "-moz-user-select": "none",
            "-o-user-select": "none",
            "-webkit-user-select": "none"
        });
    };

    $.fn.dropotron = function(options) {
        if (this.length === 0) return $(this);
        if (this.length > 1) {
            for (var i = 0; i < this.length; i++) {
                $(this[i]).dropotron(options);
            }
            return $(this);
        }
        return $.dropotron($.extend({ selectorParent: $(this) }, options));
    };

    $.dropotron = function(options) {
        var defaults = {
            selectorParent: null,
            menuClass: "dropotron",
            expandMode: "click",
            hideDelay: 250,
            openerClass: "opener",
            openerActiveClass: "active",
            submenuClassPrefix: "level-",
            mode: "fade",
            speed: "fast",
            easing: "swing",
            alignment: "left",
            offsetX: 0,
            offsetY: 0,
            globalOffsetY: 0,
            IEOffsetX: 0,
            IEOffsetY: 0,
            noOpenerFade: true,
            detach: true,
            cloneOnDetach: true
        };
        
        var o = $.extend(defaults, options),
            $parent = o.selectorParent,
            $menus = $parent.find("ul"),
            $body = $("body"),
            $window = $(window),
            isAnimating = false;

        $menus.each(function() {
            var $menu = $(this),
                $parentItem = $menu.parent();

            $menu.disableSelection_dropotron().hide().addClass(o.menuClass).css("position", "absolute");

            $parentItem.addClass(o.openerClass).on("click touchend", function(event) {
                if (isAnimating) return;
                event.preventDefault();
                event.stopPropagation();
                if ($menu.is(":visible")) {
                    $menu.hide();
                    $parentItem.removeClass(o.openerActiveClass);
                } else {
                    $menus.not($menu).hide(); // Hide other menus
                    $menu.show();
                    $parentItem.addClass(o.openerActiveClass);
                }
            });

            $menu.find("a").on("click touchend", function(event) {
                if ($(this).attr("href").length < 1) {
                    event.preventDefault();
                }
            });

            $parentItem.on("mouseleave", function() {
                setTimeout(function() {
                    $menu.hide();
                    $parentItem.removeClass(o.openerActiveClass);
                }, o.hideDelay);
            });
        });

        $window.on("scroll", function() {
            $menus.hide();
            $parent.removeClass(o.openerActiveClass);
        });

        $body.on("click touchend", function() {
            if (!isAnimating) {
                $menus.hide();
                $parent.removeClass(o.openerActiveClass);
            }
        });

        return $parent;
    };
}(jQuery);
